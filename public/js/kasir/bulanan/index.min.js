$(document).ready(function(){var a,e=$("#tabelKasir").DataTable({serverSide:!0,ajax:{url:"/kasir",cache:!1},columns:[{data:"kd_kontrol",name:"kd_kontrol",class:"text-center"},{data:"tagihan",name:"tagihan",class:"text-center"},{data:"pengguna",name:"pengguna",class:"text-center-td"},{data:"lokasi",name:"lokasi",class:"text-center-td"},{data:"action",name:"action",class:"text-center"}],pageLength:5,stateSave:!0,lengthMenu:[[5,10,25,50,100,-1],[5,10,25,50,100,"All"]],deferRender:!0,language:{paginate:{previous:"<i class='fas fa-angle-left'>",next:"<i class='fas fa-angle-right'>"}},aoColumnDefs:[{bSortable:!1,aTargets:[1,2,3,4]},{bSearchable:!1,aTargets:[1,2,3,4]}],order:[[0,"asc"]],preDrawCallback:function(e){a=$(".dataTables_scrollBody").scrollTop()},drawCallback:function(e){$(".dataTables_scrollBody").scrollTop(a)},responsive:!0}).columns.adjust().draw();setInterval(function(){e.ajax.reload(function(){console.log("Refresh Automatic")},!1)},6e4),$("#refresh").click(function(){$("#refresh-img").show(),$("#refresh").removeClass("btn-primary").addClass("btn-success").html("Refreshing"),e.ajax.reload(function(){console.log("Refresh Manual")},!1),setTimeout(function(){$("#refresh").removeClass("btn-success").addClass("btn-primary").html('<i class="fas fa-sync-alt"></i> Refresh Data'),$("#refresh-data").text("Refresh Data"),$("#refresh-img").hide()},2e3)}),$("#tab-c-1").click(function(){if(!$.fn.dataTable.isDataTable("#tabelRestore")){var a=$("#tabelRestore").DataTable({serverSide:!0,ajax:{url:"/kasir/restore",cache:!1},columns:[{data:"kd_kontrol",name:"kd_kontrol",class:"text-center"},{data:"tagihan",name:"tagihan",class:"text-center"},{data:"pengguna",name:"pengguna",class:"text-center-td"},{data:"lokasi",name:"lokasi",class:"text-center-td"},{data:"action",name:"action",class:"text-center"}],pageLength:5,stateSave:!0,lengthMenu:[[5,10,25,50,100,-1],[5,10,25,50,100,"All"]],deferRender:!0,language:{paginate:{previous:"<i class='fas fa-angle-left'>",next:"<i class='fas fa-angle-right'>"}},aoColumnDefs:[{bSortable:!1,aTargets:[1,2,3,4]},{bSearchable:!1,aTargets:[1,2,3,4]}],order:[[0,"asc"]],responsive:!0}).columns.adjust().draw();setInterval(function(){a.ajax.reload(function(){console.log("Refresh Automatic")},!1)},6e4),$("#refresh").click(function(){$("#refresh-img").show(),$("#refresh").removeClass("btn-primary").addClass("btn-success").html("Refreshing"),a.ajax.reload(function(){console.log("Refresh Manual")},!1),setTimeout(function(){$("#refresh").removeClass("btn-success").addClass("btn-primary").html('<i class="fas fa-sync-alt"></i> Refresh Data'),$("#refresh-data").text("Refresh Data"),$("#refresh-img").hide()},2e3)})}}),$("#tab-c-2").click(function(){if(!$.fn.dataTable.isDataTable("#tabelStruk")){var e=$("#tabelStruk").DataTable({serverSide:!0,ajax:{url:"/kasir/struk/tagihan",cache:!1},columns:[{data:"kd_kontrol",name:"kd_kontrol",class:"text-center"},{data:"bayar",name:"bayar",class:"text-center"},{data:"totalTagihan",name:"totalTagihan",class:"text-center"},{data:"lokasi",name:"lokasi",class:"text-center-td"},{data:"action",name:"action",class:"text-center"}],pageLength:5,stateSave:!0,lengthMenu:[[5,10,25,50,100,-1],[5,10,25,50,100,"All"]],deferRender:!0,language:{paginate:{previous:"<i class='fas fa-angle-left'>",next:"<i class='fas fa-angle-right'>"}},aoColumnDefs:[{bSortable:!1,aTargets:[1,2,3,4]},{bSearchable:!1,aTargets:[1,2,3,4]}],order:[[0,"asc"]],preDrawCallback:function(e){a=$(".dataTables_scrollBody").scrollTop()},drawCallback:function(e){$(".dataTables_scrollBody").scrollTop(a)},responsive:!0}).columns.adjust().draw();setInterval(function(){e.ajax.reload(function(){console.log("Refresh Automatic")},!1)},6e4),$("#refresh").click(function(){$("#refresh-img").show(),$("#refresh").removeClass("btn-primary").addClass("btn-success").html("Refreshing"),e.ajax.reload(function(){console.log("Refresh Manual")},!1),setTimeout(function(){$("#refresh").removeClass("btn-success").addClass("btn-primary").html('<i class="fas fa-sync-alt"></i> Refresh Data'),$("#refresh-data").text("Refresh Data"),$("#refresh-img").hide()},2e3)})}}),$(document).on("click",".cetak",function(a){i("/kasir/struk/tagihan/"+(t=$(this).attr("id"))),console.log("Printing . . .")});var t="";function i(a){$.get(a,function(a){navigator.userAgent.toLowerCase().indexOf("android")>-1?function(a){window.location.href=a}(a):function(a){var e=new WebSocket("ws://127.0.0.1:40213/");e.bufferType="arraybuffer",e.onerror=function(a){console.log("Transaksi Berhasil Tanpa Print Struk")},e.onopen=function(){e.send(a),e.close(1e3,"Work complete")}}(a)}).fail(function(a){console.log(a)})}$(document).on("click",".restore",function(){t=$(this).attr("id"),username=$(this).attr("nama"),$(".titles").text("Restore Pembayaran "+username+" ?"),$("#confirmModal").modal("show")}),$("#ok_button").click(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.ajax({url:"/kasir/restore/"+t,cache:!1,method:"POST",dataType:"json",success:function(a){$("#tabelRestore").DataTable().ajax.reload(function(){},!1);var e="";a.errors&&(e='<div class="alert alert-danger" id="error-alert"> <strong>Maaf ! </strong>'+a.errors+"</div>"),a.success&&(e='<div class="alert alert-success" id="success-alert"> <strong>Sukses ! </strong>'+a.success+"</div>"),$("#form_result").html(e),$("#success-alert,#error-alert,#info-alert,#warning-alert").fadeTo(1e3,500).slideUp(1e3,function(){$("#success-alert,#error-alert").slideUp(500)}),$("#confirmModal").modal("hide")}})}),$(document).on("click",".bayar",function(){kontrol=$(this).attr("id"),$("#form_rincian")[0].reset();var a=0;$.ajax({url:"/kasir/rincian/"+kontrol,dataType:"json",cache:!1,success:function(e){$("#tempatId").val(kontrol),$("#judulRincian").html(kontrol),$("#pedagang").val(e.result.pedagang),$("#los").val(e.result.los),$("#lokasi").val(e.result.lokasi),$("#faktur").val(e.result.faktur),$("#ref").val(e.result.ref),a=0,listrik=e.result.listrik,$("#nominalListrik").html(e.result.listrik.toLocaleString("en-US")),a+=listrik,tunglistrik=e.result.tunglistrik,$("#tungnominalListrik").html(e.result.tunglistrik.toLocaleString("en-US")),a+=tunglistrik,denlistrik=e.result.denlistrik,$("#dennominalListrik").html(e.result.denlistrik.toLocaleString("en-US")),a+=denlistrik,0==listrik?$("#divListrik").hide():$("#divListrik").show(),0==tunglistrik?$("#tungdivListrik").hide():$("#tungdivListrik").show(),0==denlistrik?$("#dendivListrik").hide():$("#dendivListrik").show(),0==listrik&&0==tunglistrik&&0==denlistrik?($("#fasListrik").hide(),$("#checkListrik").prop("checked",!1).prop("disabled",!0)):($("#fasListrik").show(),$("#checkListrik").prop("checked",!0).prop("disabled",!1)),$("#taglistrik").val(e.result.listrik),$("#tagtunglistrik").val(e.result.tunglistrik),$("#tagdenlistrik").val(e.result.denlistrik),$("#tagdylistrik").val(e.result.dylistrik),$("#tagawlistrik").val(e.result.awlistrik),$("#tagaklistrik").val(e.result.aklistrik),$("#tagpklistrik").val(e.result.pklistrik),$("#checkListrik").click(function(){$(this).is(":checked")?(a=a+listrik+tunglistrik+denlistrik,$("#fasListrik").show(),$("#taglistrik").val(e.result.listrik),$("#tagtunglistrik").val(e.result.tunglistrik),$("#tagdenlistrik").val(e.result.denlistrik),$("#tagdylistrik").val(e.result.dylistrik),$("#tagawlistrik").val(e.result.awlistrik),$("#tagaklistrik").val(e.result.aklistrik),$("#tagpklistrik").val(e.result.pklistrik)):(a=a-listrik-tunglistrik-denlistrik,$("#fasListrik").hide(),$("#taglistrik").val(0),$("#tagtunglistrik").val(0),$("#tagdenlistrik").val(0),$("#tagdylistrik").val(0),$("#tagawlistrik").val(0),$("#tagaklistrik").val(0),$("#tagpklistrik").val(0)),$("#nominalTotal").html("Rp. "+a.toLocaleString("en-US")),$("#totalTagihan").val(a)}),airbersih=e.result.airbersih,$("#nominalAirBersih").html(e.result.airbersih.toLocaleString("en-US")),a+=airbersih,tungairbersih=e.result.tungairbersih,$("#tungnominalAirBersih").html(e.result.tungairbersih.toLocaleString("en-US")),a+=tungairbersih,denairbersih=e.result.denairbersih,$("#dennominalAirBersih").html(e.result.denairbersih.toLocaleString("en-US")),a+=denairbersih,0==airbersih?$("#divAirBersih").hide():$("#divAirBersih").show(),0==tungairbersih?$("#tungdivAirBersih").hide():$("#tungdivAirBersih").show(),0==denairbersih?$("#dendivAirBersih").hide():$("#dendivAirBersih").show(),0==airbersih&&0==tungairbersih&&0==denairbersih?($("#fasAirBersih").hide(),$("#checkAirBersih").prop("checked",!1).prop("disabled",!0)):($("#fasAirBersih").show(),$("#checkAirBersih").prop("checked",!0).prop("disabled",!1)),$("#tagairbersih").val(e.result.airbersih),$("#tagtungairbersih").val(e.result.tungairbersih),$("#tagdenairbersih").val(e.result.denairbersih),$("#tagawairbersih").val(e.result.awairbersih),$("#tagakairbersih").val(e.result.akairbersih),$("#tagpkairbersih").val(e.result.pkairbersih),$("#checkAirBersih").click(function(){$(this).is(":checked")?(a=a+airbersih+tungairbersih+denairbersih,$("#fasAirBersih").show(),$("#tagairbersih").val(e.result.airbersih),$("#tagtungairbersih").val(e.result.tungairbersih),$("#tagdenairbersih").val(e.result.denairbersih),$("#tagawairbersih").val(e.result.awairbersih),$("#tagakairbersih").val(e.result.akairbersih),$("#tagpkairbersih").val(e.result.pkairbersih)):(a=a-airbersih-tungairbersih-denairbersih,$("#fasAirBersih").hide(),$("#tagairbersih").val(0),$("#tagtungairbersih").val(0),$("#tagdenairbersih").val(0),$("#tagawairbersih").val(0),$("#tagakairbersih").val(0),$("#tagpkairbersih").val(0)),$("#nominalTotal").html("Rp. "+a.toLocaleString("en-US")),$("#totalTagihan").val(a)}),keamananipk=e.result.keamananipk,$("#nominalKeamananIpk").html(e.result.keamananipk.toLocaleString("en-US")),a+=keamananipk,tungkeamananipk=e.result.tungkeamananipk,$("#tungnominalKeamananIpk").html(e.result.tungkeamananipk.toLocaleString("en-US")),a+=tungkeamananipk,0==keamananipk?$("#divKeamananIpk").hide():$("#divKeamananIpk").show(),0==tungkeamananipk?$("#tungdivKeamananIpk").hide():$("#tungdivKeamananIpk").show(),0==keamananipk&&0==tungkeamananipk?($("#fasKeamananIpk").hide(),$("#checkKeamananIpk").prop("checked",!1).prop("disabled",!0)):($("#fasKeamananIpk").show(),$("#checkKeamananIpk").prop("checked",!0).prop("disabled",!1)),$("#tagkeamananipk").val(e.result.keamananipk),$("#tagtungkeamananipk").val(e.result.tungkeamananipk),$("#tagdenkeamananipk").val(e.result.denkeamananipk),$("#checkKeamananIpk").click(function(){$(this).is(":checked")?(a=a+keamananipk+tungkeamananipk,$("#fasKeamananIpk").show(),$("#tagkeamananipk").val(e.result.keamananipk),$("#tagtungkeamananipk").val(e.result.tungkeamananipk),$("#tagdenkeamananipk").val(e.result.denkeamananipk)):(a=a-keamananipk-tungkeamananipk,$("#fasKeamananIpk").hide(),$("#tagkeamananipk").val(0),$("#tagtungkeamananipk").val(0),$("#tagdenkeamananipk").val(0)),$("#nominalTotal").html("Rp. "+a.toLocaleString("en-US")),$("#totalTagihan").val(a)}),kebersihan=e.result.kebersihan,$("#nominalKebersihan").html(e.result.kebersihan.toLocaleString("en-US")),a+=kebersihan,tungkebersihan=e.result.tungkebersihan,$("#tungnominalKebersihan").html(e.result.tungkebersihan.toLocaleString("en-US")),a+=tungkebersihan,0==kebersihan?$("#divKebersihan").hide():$("#divKebersihan").show(),0==tungkebersihan?$("#tungdivKebersihan").hide():$("#tungdivKebersihan").show(),0==kebersihan&&0==tungkebersihan?($("#fasKebersihan").hide(),$("#checkKebersihan").prop("checked",!1).prop("disabled",!0)):($("#fasKebersihan").show(),$("#checkKebersihan").prop("checked",!0).prop("disabled",!1)),$("#tagkebersihan").val(e.result.kebersihan),$("#tagtungkebersihan").val(e.result.tungkebersihan),$("#tagdenkebersihan").val(e.result.denkebersihan),$("#checkKebersihan").click(function(){$(this).is(":checked")?(a=a+kebersihan+tungkebersihan,$("#fasKebersihan").show(),$("#tagkebersihan").val(e.result.kebersihan),$("#tagtungkebersihan").val(e.result.tungkebersihan),$("#tagdenkebersihan").val(e.result.denkebersihan)):(a=a-kebersihan-tungkebersihan,$("#fasKebersihan").hide(),$("#tagkebersihan").val(0),$("#tagtungkebersihan").val(0),$("#tagdenkebersihan").val(0)),$("#nominalTotal").html("Rp. "+a.toLocaleString("en-US")),$("#totalTagihan").val(a)}),airkotor=e.result.airkotor,$("#nominalAirKotor").html(e.result.airkotor.toLocaleString("en-US")),a+=airkotor,tungairkotor=e.result.tungairkotor,$("#tungnominalAirKotor").html(e.result.tungairkotor.toLocaleString("en-US")),a+=tungairkotor,0==airkotor?$("#divAirKotor").hide():$("#divAirKotor").show(),0==tungairkotor?$("#tungdivAirKotor").hide():$("#tungdivAirKotor").show(),0==airkotor&&0==tungairkotor?($("#fasAirKotor").hide(),$("#checkAirKotor").prop("checked",!1).prop("disabled",!0)):($("#fasAirKotor").show(),$("#checkAirKotor").prop("checked",!0).prop("disabled",!1)),$("#tagairkotor").val(e.result.airkotor),$("#tagtungairkotor").val(e.result.tungairkotor),$("#tagdenairkotor").val(e.result.denairkotor),$("#checkAirKotor").click(function(){$(this).is(":checked")?(a=a+airkotor+tungairkotor,$("#fasAirKotor").show(),$("#tagairkotor").val(e.result.airkotor),$("#tagtungairkotor").val(e.result.tungairkotor),$("#tagdenairkotor").val(e.result.denairkotor)):(a=a-airkotor-tungairkotor,$("#fasAirKotor").hide(),$("#tagairkotor").val(0),$("#tagtungairkotor").val(0),$("#tagdenairkotor").val(0)),$("#nominalTotal").html("Rp. "+a.toLocaleString("en-US")),$("#totalTagihan").val(a)}),lain=e.result.lain,$("#nominalLain").html(e.result.lain.toLocaleString("en-US")),a+=lain,tunglain=e.result.tunglain,$("#tungnominalLain").html(e.result.tunglain.toLocaleString("en-US")),a+=tunglain,0==lain?$("#divLain").hide():$("#divLain").show(),0==tunglain?$("#tungdivLain").hide():$("#tungdivLain").show(),0==lain&&0==tunglain?($("#fasLain").hide(),$("#checkLain").prop("checked",!1).prop("disabled",!0)):($("#fasLain").show(),$("#checkLain").prop("checked",!0).prop("disabled",!1)),$("#taglain").val(e.result.lain),$("#tagtunglain").val(e.result.tunglain),$("#tagdenlain").val(e.result.denlain),$("#checkLain").click(function(){$(this).is(":checked")?(a=a+lain+tunglain,$("#fasLain").show(),$("#taglain").val(e.result.lain),$("#tagtunglain").val(e.result.tunglain),$("#tagdenlain").val(e.result.denlain)):(a=a-lain-tunglain,$("#fasLain").hide(),$("#taglain").val(0),$("#tagtunglain").val(0),$("#tagdenlain").val(0)),$("#nominalTotal").html("Rp. "+a.toLocaleString("en-US")),$("#totalTagihan").val(a)}),$("#nominalTotal").html("Rp. "+a.toLocaleString("en-US")),$("#totalTagihan").val(a),$("#myRincian").modal("show")}}),kode_kontrol=kontrol}),$("#form_rincian").on("submit",function(a){a.preventDefault(),$.ajax({url:"/kasir",cache:!1,method:"POST",data:$(this).serialize(),dataType:"json",success:function(a){var e="";"error"==a.result.status&&(e='<div class="alert alert-danger" id="error-alert"> <strong>Oops ! </strong> Transaksi Gagal</div>'),"success"==a.result.status&&(e='<div class="alert alert-success" id="success-alert"> <strong>Sukses ! </strong>Transaksi Berhasil</div>',0!=a.result.totalTagihan&&i("/kasir/bayar/"+JSON.stringify(a.result))),$("#tabelKasir").DataTable().ajax.reload(function(){},!1),$("#myRincian").modal("hide"),$("#form_result").html(e),$("#success-alert,#error-alert,#info-alert,#warning-alert").fadeTo(1e3,500).slideUp(1e3,function(){$("#success-alert,#error-alert").slideUp(500)})}})}),$("#sebagian").prop("required",!1),$("#sebagian").select2({placeholder:"--- Pilih Blok ---",ajax:{url:"/cari/blok",dataType:"json",delay:250,processResults:function(a){return{results:$.map(a,function(a){return{text:a.nama,id:a.nama}})}},cache:!0}}),$("#sisatagihan").change(function(){var a=$(this).val();"all"===a?($("#divrekapsisa").hide(),$("#sebagian").prop("required",!1),$("#sebagian").val(""),$("#sebagian").html("")):"sebagian"===a&&($("#divrekapsisa").show(),$("#sebagian").prop("required",!0))})});