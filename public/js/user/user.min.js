$(document).ready(function(){var a,e,t,s,r=$("#userAdmin").DataTable({serverSide:!0,ajax:{url:"/user",cache:!1},columns:[{data:"username",name:"username",class:"text-center"},{data:"nama",name:"nama",class:"text-center-td"},{data:"otoritas",name:"otoritas",class:"text-center"},{data:"action",name:"action",class:"text-center"},{data:"show",name:"show",class:"text-center"}],stateSave:!0,deferRender:!0,pageLength:8,language:{paginate:{previous:"<i class='fas fa-angle-left'>",next:"<i class='fas fa-angle-right'>"}},aoColumnDefs:[{bSortable:!1,aTargets:[2,3,4]},{bSearchable:!1,aTargets:[2,3,4]}],responsive:!0});setInterval(function(){r.ajax.reload(function(){console.log("Refresh Automatic")},!1)},6e4),$("#refresh").click(function(){$("#refresh-img").show(),$("#refresh").removeClass("btn-primary").addClass("btn-success").html("Refreshing"),r.ajax.reload(function(){console.log("Refresh Manual")},!1),setTimeout(function(){$("#refresh").removeClass("btn-success").addClass("btn-primary").html('<i class="fas fa-sync-alt"></i> Refresh Data'),$("#refresh-data").text("Refresh Data"),$("#refresh-img").hide()},2e3)}),$("#tab-c-1").click(function(){if(!$.fn.dataTable.isDataTable("#userManajer")){var a=$("#userManajer").DataTable({serverSide:!0,ajax:"/user/manajer",columns:[{data:"username",name:"username",class:"text-center"},{data:"nama",name:"nama",class:"text-center-td"},{data:"action",name:"action",class:"text-center"},{data:"show",name:"show",class:"text-center"}],stateSave:!0,deferRender:!0,pageLength:8,language:{paginate:{previous:"<i class='fas fa-angle-left'>",next:"<i class='fas fa-angle-right'>"}},aoColumnDefs:[{bSortable:!1,aTargets:[2,3]},{bSearchable:!1,aTargets:[2,3]}],responsive:!0});setInterval(function(){a.ajax.reload(function(){console.log("Refresh Automatic")},!1)},6e4),$("#refresh").click(function(){$("#refresh-img").show(),$("#refresh").removeClass("btn-primary").addClass("btn-success").html("Refreshing"),a.ajax.reload(function(){console.log("Refresh Manual")},!1),setTimeout(function(){$("#refresh").removeClass("btn-success").addClass("btn-primary").html('<i class="fas fa-sync-alt"></i> Refresh Data'),$("#refresh-data").text("Refresh Data"),$("#refresh-img").hide()},2e3)})}}),$("#tab-c-2").click(function(){if(!$.fn.dataTable.isDataTable("#userKeuangan")){var a=$("#userKeuangan").DataTable({serverSide:!0,ajax:"/user/keuangan",columns:[{data:"username",name:"username",class:"text-center"},{data:"nama",name:"nama",class:"text-center-td"},{data:"action",name:"action",class:"text-center"},{data:"show",name:"show",class:"text-center"}],stateSave:!0,deferRender:!0,pageLength:8,language:{paginate:{previous:"<i class='fas fa-angle-left'>",next:"<i class='fas fa-angle-right'>"}},aoColumnDefs:[{bSortable:!1,aTargets:[2,3]},{bSearchable:!1,aTargets:[2,3]}],responsive:!0});setInterval(function(){a.ajax.reload(function(){console.log("Refresh Automatic")},!1)},6e4),$("#refresh").click(function(){$("#refresh-img").show(),$("#refresh").removeClass("btn-primary").addClass("btn-success").html("Refreshing"),a.ajax.reload(function(){console.log("Refresh Manual")},!1),setTimeout(function(){$("#refresh").removeClass("btn-success").addClass("btn-primary").html('<i class="fas fa-sync-alt"></i> Refresh Data'),$("#refresh-data").text("Refresh Data"),$("#refresh-img").hide()},2e3)})}}),$("#tab-c-3").click(function(){if(!$.fn.dataTable.isDataTable("#userKasir")){var a=$("#userKasir").DataTable({serverSide:!0,ajax:"/user/kasir",columns:[{data:"username",name:"username",class:"text-center"},{data:"nama",name:"nama",class:"text-center-td"},{data:"action",name:"action",class:"text-center"},{data:"show",name:"show",class:"text-center"}],stateSave:!0,deferRender:!0,pageLength:8,language:{paginate:{previous:"<i class='fas fa-angle-left'>",next:"<i class='fas fa-angle-right'>"}},aoColumnDefs:[{bSortable:!1,aTargets:[2,3]},{bSearchable:!1,aTargets:[2,3]}],responsive:!0});setInterval(function(){a.ajax.reload(function(){console.log("Refresh Automatic")},!1)},6e4),$("#refresh").click(function(){$("#refresh-img").show(),$("#refresh").removeClass("btn-primary").addClass("btn-success").html("Refreshing"),a.ajax.reload(function(){console.log("Refresh Manual")},!1),setTimeout(function(){$("#refresh").removeClass("btn-success").addClass("btn-primary").html('<i class="fas fa-sync-alt"></i> Refresh Data'),$("#refresh-data").text("Refresh Data"),$("#refresh-img").hide()},2e3)})}}),$("#tab-c-4").click(function(){if(!$.fn.dataTable.isDataTable("#userNasabah")){var a=$("#userNasabah").DataTable({serverSide:!0,ajax:"/user/nasabah",columns:[{data:"username",name:"username",class:"text-center"},{data:"nama",name:"nama",class:"text-center-td"},{data:"action",name:"action",class:"text-center"},{data:"show",name:"show",class:"text-center"}],stateSave:!0,deferRender:!0,pageLength:8,language:{paginate:{previous:"<i class='fas fa-angle-left'>",next:"<i class='fas fa-angle-right'>"}},aoColumnDefs:[{bSortable:!1,aTargets:[2,3]},{bSearchable:!1,aTargets:[2,3]}],responsive:!0});setInterval(function(){a.ajax.reload(function(){console.log("Refresh Automatic")},!1)},6e4),$("#refresh").click(function(){$("#refresh-img").show(),$("#refresh").removeClass("btn-primary").addClass("btn-success").html("Refreshing"),a.ajax.reload(function(){console.log("Refresh Manual")},!1),setTimeout(function(){$("#refresh").removeClass("btn-success").addClass("btn-primary").html('<i class="fas fa-sync-alt"></i> Refresh Data'),$("#refresh-data").text("Refresh Data"),$("#refresh-img").hide()},2e3)})}}),$("#add_user").click(function(){$(".titles").text("Tambah User"),$("#action_btn").val("Tambah"),$("#action").val("Add"),$("#form_result").html(""),$("#form_user")[0].reset(),$("#myModal").modal("show")}),$("#form_user").on("submit",function(a){a.preventDefault();var e="";"Add"==$("#action").val()&&(e="/user"),"Edit"==$("#action").val()&&(e="/user/update"),$.ajax({url:e,cache:!1,method:"POST",data:$(this).serialize(),dataType:"json",success:function(a){var e="";if("error"==a.result.status&&(e='<div class="alert alert-danger" id="error-alert"> <strong>Maaf ! </strong>'+a.result.message+"</div>"),"success"==a.result.status){e='<div class="alert alert-success" id="success-alert"> <strong>Sukses ! </strong>'+a.result.message+"</div>",$("#form_user")[0].reset();try{"admin"==a.result.role&&$("#tab-c-0").trigger("click"),"manajer"==a.result.role&&$("#tab-c-1").trigger("click"),"keuangan"==a.result.role&&$("#tab-c-2").trigger("click"),"kasir"==a.result.role&&$("#tab-c-3").trigger("click")}catch(a){}finally{"admin"==a.result.role&&$("#userAdmin").DataTable().ajax.reload(function(){},!1),"manajer"==a.result.role&&$("#userManajer").DataTable().ajax.reload(function(){},!1),"keuangan"==a.result.role&&$("#userKeuangan").DataTable().ajax.reload(function(){},!1),"kasir"==a.result.role&&$("#userKasir").DataTable().ajax.reload(function(){},!1)}}$("#form_result").html(e),$("#success-alert,#error-alert,#info-alert,#warning-alert").fadeTo(1e3,500).slideUp(1e3,function(){$("#success-alert,#error-alert").slideUp(500)}),$("#myModal").modal("hide")}})}),$(document).on("click",".edit",function(){a=$(this).attr("id"),$.ajax({url:"/user/"+a+"/edit",cache:!1,dataType:"json",success:function(e){$("#ktp").val(e.result.ktp),$("#nama").val(e.result.nama),$("#username").val(e.result.username),$("#password").val(),$("#anggota").val(e.result.anggota),$("#email").val(e.result.email),$("#hp").val(e.result.hp),"admin"==e.result.role&&$("#roleAdmin").prop("checked",!0),"manajer"==e.result.role&&$("#roleManajer").prop("checked",!0),"keuangan"==e.result.role&&$("#roleKeuangan").prop("checked",!0),"kasir"==e.result.role&&$("#roleKasir").prop("checked",!0),$("#hidden_id").val(a),$(".titles").text("Edit Pedagang"),$("#action_btn").val("Update"),$("#action").val("Edit"),$("#myModal").modal("show")}})}),$("#nama").on("input",function(){"Add"==$("#action").val()&&(nama=$(this).val(),username=nama.replace(/[^a-zA-Z]/g,""),nama=username,username=username.slice(0,7),number=Math.floor(1e3+9e3*Math.random()),pass=function(a){for(var e=a.split(""),t=e.length;t>0;){var s=parseInt(Math.random()*t),r=e[--t];e[t]=e[s],e[s]=r}return e.join("")}("abcdefghjkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ123456789"),pass=pass.slice(0,8),""==nama?(document.getElementById("username").value="",document.getElementById("password").value=""):(document.getElementById("username").value=username+number,document.getElementById("password").value=pass))}),$(".toggle-password").click(function(){$(this).toggleClass("fa-eye fa-eye-slash");var a=$($(this).attr("toggle"));"password"==a.attr("type")?a.attr("type","text"):a.attr("type","password")}),$(document).on("click",".delete",function(){e=$(this).attr("id"),nama=$(this).attr("nama"),$(".titles").text("Hapus data "+nama+" ?"),$("#confirmModal").modal("show")}),$("#ok_button").click(function(){$.ajax({url:"/user/destroy/"+e,cache:!1,beforeSend:function(){$("#ok_button").text("Menghapus...")},success:function(a){"admin"==a.result.role&&$("#userAdmin").DataTable().ajax.reload(function(){},!1),"manajer"==a.result.role&&$("#userManajer").DataTable().ajax.reload(function(){},!1),"keuangan"==a.result.role&&$("#userKeuangan").DataTable().ajax.reload(function(){},!1),"kasir"==a.result.role&&$("#userKasir").DataTable().ajax.reload(function(){},!1),"nasabah"==a.result.role&&$("#userNasabah").DataTable().ajax.reload(function(){},!1),a.result.success&&(html='<div class="alert alert-success" id="success-alert"> <strong>Sukses! </strong>'+a.result.success+"</div>"),a.result.errors&&(html='<div class="alert alert-danger" id="error-alert"> <strong>Oops! </strong>'+a.result.errors+"</div>"),$("#form_result").html(html),$("#success-alert,#error-alert,#info-alert,#warning-alert").fadeTo(1e3,500).slideUp(1e3,function(){$("#success-alert,#error-alert").slideUp(500)}),$("#confirmModal").modal("hide")},complete:function(){$("#ok_button").text("Hapus")}})}),$(".blokOtoritas").select2({placeholder:"--- Pilih Blok ---",ajax:{url:"/cari/blok",dataType:"json",delay:250,processResults:function(a){return{results:$.map(a,function(a){return{text:a.nama,id:a.nama}})}},cache:!0}}),$(document).on("click",".otoritas",function(){a=$(this).attr("id"),nama=$(this).attr("nama"),$(".titles").text("Otoritas "+nama),$("#blokOtoritas").select2("val",""),$("#blokOtoritas").html(""),$("#pedagang").prop("checked",!1),$("#tempatusaha").prop("checked",!1),$("#tagihan").prop("checked",!1),$("#blok").prop("checked",!1),$("#pemakaian").prop("checked",!1),$("#pendapatan").prop("checked",!1),$("#datausaha").prop("checked",!1),$("#publish").prop("checked",!1),$("#alatmeter").prop("checked",!1),$("#tarif").prop("checked",!1),$("#harilibur").prop("checked",!1),$("#layanan").prop("checked",!1),$("#simulasi").prop("checked",!1),$("#myOtoritas").modal("show"),$.ajax({url:"/user/"+a+"/otoritas",cache:!1,dataType:"json",success:function(e){if($("#username_otoritas").val(e.result.username),$("#nama_otoritas").val(e.result.nama),$("#hidden_id_otoritas").val(a),$("#action_btn_otoritas").val("Update"),null!=e.result.blok){var t=$("#blokOtoritas").select2(),s=e.result.bloks;s.forEach(function(a){t.find("option:contains("+a+")").length||t.append($("<option>").text(a))}),t.val(s).trigger("change"),$(".blokOtoritas").select2({placeholder:"--- Pilih Blok ---",ajax:{url:"/cari/blok",dataType:"json",delay:250,processResults:function(a){return{results:$.map(a,function(a){return{text:a.nama,id:a.nama}})}},cache:!0}}),1==e.result.pedagang&&$("#pedagang").prop("checked",!0),1==e.result.tempatusaha&&$("#tempatusaha").prop("checked",!0),1==e.result.tagihan&&$("#tagihan").prop("checked",!0),1==e.result.blok&&$("#blok").prop("checked",!0),1==e.result.pemakaian&&$("#pemakaian").prop("checked",!0),1==e.result.pendapatan&&$("#pendapatan").prop("checked",!0),1==e.result.datausaha&&$("#datausaha").prop("checked",!0),1==e.result.publish&&$("#publish").prop("checked",!0),1==e.result.alatmeter&&$("#alatmeter").prop("checked",!0),1==e.result.tarif&&$("#tarif").prop("checked",!0),1==e.result.harilibur&&$("#harilibur").prop("checked",!0),1==e.result.layanan&&$("#layanan").prop("checked",!0),1==e.result.simulasi&&$("#simulasi").prop("checked",!0)}else $(".blokOtoritas").select2({placeholder:"--- Pilih Blok ---",ajax:{url:"/cari/blok",dataType:"json",delay:250,processResults:function(a){return{results:$.map(a,function(a){return{text:a.nama,id:a.nama}})}},cache:!0}})}})}),$("#form_otoritas").on("submit",function(a){a.preventDefault(),$.ajax({url:"/user/otoritas",cache:!1,method:"POST",data:$(this).serialize(),dataType:"json",success:function(a){$("#userAdmin").DataTable().ajax.reload(function(){},!1);var e="";a.errors&&(e='<div class="alert alert-danger" id="error-alert"> <strong>Maaf ! </strong>'+a.errors+"</div>"),a.success&&(e='<div class="alert alert-success" id="success-alert"> <strong>Sukses ! </strong>'+a.success+"</div>"),$("#form_result").html(e),$("#success-alert,#error-alert,#info-alert,#warning-alert").fadeTo(1e3,500).slideUp(1e3,function(){$("#success-alert,#error-alert").slideUp(500)}),$("#myOtoritas").modal("hide")}})}),$(document).on("click",".reset",function(){t=$(this).attr("id"),s=$(this).attr("nama"),$(".titles").text("Reset password "+s+" ?"),$("#confirmReset").modal("show")}),$("#ya_button").click(function(){$("#confirmReset").modal("hide"),$(".titles").text("Password baru "+s),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.ajax({url:"/user/reset/"+t,cache:!1,method:"POST",data:$(this).serialize(),dataType:"json",success:function(a){var e="";a.errors&&(e=a.errors),a.success&&(e=a.success),$("#password_baru").html(e),$("#resetModal").modal("show")}})}),$(document).on("click",".details",function(){a=$(this).attr("id"),username=$(this).attr("nama"),$(".titles").html("<h1 style='color:white;font-weight:700;'>"+username+"</h1>"),$.ajax({url:"/user/details/"+a,cache:!1,dataType:"json",success:function(a){null!==a.result.ktp?$(".ktp").text(a.result.ktp):$(".ktp").html("&mdash;"),null!==a.result.anggota?$(".anggota").text(a.result.anggota):$(".anggota").html("&mdash;"),null!==a.result.alamat?$(".alamat").text(a.result.alamat):$(".alamat").html("&mdash;"),null!==a.result.hp?$("#whatsapp-number").attr("href","https://api.whatsapp.com/send?phone="+a.result.hp+"&text=*Selamat%20Berniaga%20Mitra%20BP3C*").attr("target","_blank").css("pointer-events","").removeClass("btn-dark").addClass("btn-success"):$("#whatsapp-number").attr("href","#").removeAttr("target").css("pointer-events","none").removeClass("btn-success").addClass("btn-dark"),null!==a.result.email?$("#email-number").attr("href","mailto:"+a.result.email).attr("target","_blank").css("pointer-events","").removeClass("btn-dark").addClass("btn-danger"):$("#email-number").attr("href","#").removeAttr("target").css("pointer-events","none").removeClass("btn-danger").addClass("btn-dark"),$("#show-details").modal("show")}})}),$(document).on("click",".otoritas-kasir",function(){a=$(this).attr("id"),nama=$(this).attr("nama"),$(".titles").text("Otoritas "+nama),$("#lapangan_kasir").prop("checked",!1),$("#kepala_kasir").prop("checked",!1),$("#myKasir").modal("show"),$.ajax({url:"/user/"+a+"/kasir",cache:!1,dataType:"json",success:function(e){$("#username_kasir").val(e.result.username),$("#nama_kasir").val(e.result.nama),$("#hidden_id_kasir").val(a),$("#action_btn_kasir").val("Update"),1==e.result.kepala&&$("#kepala_kasir").prop("checked",!0),1==e.result.lapangan&&$("#lapangan_kasir").prop("checked",!0)}})}),$("#form_kasir").on("submit",function(a){a.preventDefault(),$.ajax({url:"/user/otoritas/kasir",cache:!1,method:"POST",data:$(this).serialize(),dataType:"json",success:function(a){$("#userKasir").DataTable().ajax.reload(function(){},!1);var e="";a.errors&&(e='<div class="alert alert-danger" id="error-alert"> <strong>Maaf ! </strong>'+a.errors+"</div>"),a.success&&(e='<div class="alert alert-success" id="success-alert"> <strong>Sukses ! </strong>'+a.success+"</div>"),$("#form_result").html(e),$("#success-alert,#error-alert,#info-alert,#warning-alert").fadeTo(1e3,500).slideUp(1e3,function(){$("#success-alert,#error-alert").slideUp(500)}),$("#myKasir").modal("hide")}})}),$("[type=tel]").on("change",function(a){$(a.target).val($(a.target).val().replace(/[^\d\.]/g,""))}),$("[type=tel]").on("keypress",function(a){return keys=["0","1","2","3","4","5","6","7","8","9"],keys.indexOf(a.key)>-1}),$("#nama").on("change paste keyup",function(a){$(a.target).val($(a.target).val().replace(/[^a-zA-Z.\s]/gi,""))})});