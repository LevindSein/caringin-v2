$(document).ready(function(){var e,a,t=$("#tabelPedagang").DataTable({serverSide:!0,ajax:{url:"/pedagang",cache:!1},columns:[{data:"nama",name:"nama",class:"text-center-td"},{data:"action",name:"action",class:"text-center"},{data:"show",name:"show",class:"text-center"}],stateSave:!0,deferRender:!0,pageLength:8,language:{paginate:{previous:"<i class='fas fa-angle-left'>",next:"<i class='fas fa-angle-right'>"}},aoColumnDefs:[{bSortable:!1,aTargets:[1,2]},{bSearchable:!1,aTargets:[1,2]}],order:[[0,"asc"]],responsive:!0});function n(){var e=$(this),a=$("#"+e.attr("data-related-item")).parent();e.is(":checked")?a.fadeIn():a.fadeOut()}function r(){$("#pemilik").is(":checked")?document.getElementById("alamatPemilik").required=!0:document.getElementById("alamatPemilik").required=!1}function s(){$("#pengguna").is(":checked")?document.getElementById("alamatPengguna").required=!0:document.getElementById("alamatPengguna").required=!1}setInterval(function(){t.ajax.reload(function(){console.log("Refresh Automatic")},!1)},6e4),$("#refresh").click(function(){$("#refresh-img").show(),$("#refresh").removeClass("btn-primary").addClass("btn-success").html("Refreshing"),t.ajax.reload(function(){console.log("Refresh Manual")},!1),setTimeout(function(){$("#refresh").removeClass("btn-success").addClass("btn-primary").html('<i class="fas fa-sync-alt"></i> Refresh Data'),$("#refresh-data").text("Refresh Data"),$("#refresh-img").hide()},2e3)}),$(".alamatPemilik").select2(),$(".alamatPengguna").select2(),$("#add_pedagang").click(function(){$(".titles").text("Tambah Pedagang"),$("#alamatPemilik").prop("required",!1),$("#alamatPengguna").prop("required",!1),$("#action_btn").val("Tambah"),$("#action").val("Add"),$("#form_result").html(""),$("#form_pedagang")[0].reset(),$("#displayPemilik").hide(),$("#displayPengguna").hide(),$("#username").val(),$("#form_pedagang")[0].reset(),$("#alamatPemilik").select2("destroy").val("").html("").select2({placeholder:"--- Pilih Kepemilikan ---",ajax:{url:"/cari/alamat",dataType:"json",delay:250,processResults:function(e){return{results:$.map(e,function(e){return{text:e.kd_kontrol,id:e.id}})}},cache:!0}}),$("#alamatPengguna").select2("destroy").val("").html("").select2({placeholder:"--- Pilih Tempat ---",ajax:{url:"/cari/alamat",dataType:"json",delay:250,processResults:function(e){return{results:$.map(e,function(e){return{text:e.kd_kontrol,id:e.id}})}},cache:!0}}),$("#myModal").modal("show")}),$(document).on("click",".edit",function(){e=$(this).attr("id"),$("#hidden_id").val(e),$(".titles").text("Edit Pedagang"),$("#alamatPemilik").prop("required",!1),$("#alamatPengguna").prop("required",!1),$("#action_btn").val("Update"),$("#action").val("Edit"),$("#form_result").html(""),$("#form_pedagang")[0].reset(),$("#displayPemilik").hide(),$("#displayPengguna").hide(),$("#username").val(),$("#form_pedagang")[0].reset();var a=$("#alamatPemilik").select2("destroy").val("").html("").select2({placeholder:"--- Pilih Kepemilikan ---",ajax:{url:"/cari/alamat",dataType:"json",delay:250,processResults:function(e){return{results:$.map(e,function(e){return{text:e.kd_kontrol,id:e.id}})}},cache:!0}}),t=$("#alamatPengguna").select2("destroy").val("").html("").select2({placeholder:"--- Pilih Tempat ---",ajax:{url:"/cari/alamat",dataType:"json",delay:250,processResults:function(e){return{results:$.map(e,function(e){return{text:e.kd_kontrol,id:e.id}})}},cache:!0}});$.ajax({url:"/pedagang/"+e+"/edit",cache:!1,dataType:"json",success:function(e){if($("#ktp").val(e.result.ktp),$("#nama").val(e.result.nama),$("#username").val(e.result.username),$("#anggota").val(e.result.anggota),$("#email").val(e.result.email),$("#hp").val(e.result.hp),$("#alamat").val(e.result.alamat),"checked"==e.result.checkPemilik){$("#pemilik").prop("checked",!0),$("#alamatPemilik").prop("required",!0),$("#displayPemilik").show();var n=e.result.pemilik;n.forEach(function(e){a.find("option:contains("+e+")").length||a.append($("<option>").text(e))}),a.val(n).trigger("change")}else $("#pemilik").prop("checked",!1),$("#displayPemilik").hide();if("checked"==e.result.checkPengguna){$("#pengguna").prop("checked",!0),$("#alamatPengguna").prop("required",!0),$("#displayPengguna").show();var r=e.result.pengguna;r.forEach(function(e){t.find("option:contains("+e+")").length||t.append($("<option>").text(e))}),t.val(r).trigger("change")}else $("#pengguna").prop("checked",!1),$("#displayPengguna").hide();$("#myModal").modal("show")}})}),$("#form_pedagang").on("submit",function(e){e.preventDefault();var a="";"Add"==$("#action").val()&&(a="/pedagang"),"Edit"==$("#action").val()&&(a="/pedagang/update"),$.ajax({url:a,cache:!1,method:"POST",data:$(this).serialize(),dataType:"json",success:function(e){$("#form_result").show();var a="";e.errors&&(a='<div class="alert alert-danger" id="error-alert"> <strong>Maaf ! </strong>'+e.errors+"</div>",console.log(e.errors)),e.success&&(a='<div class="alert alert-success" id="success-alert"> <strong>Sukses ! </strong>'+e.success+"</div>"),$("#tabelPedagang").DataTable().ajax.reload(function(){},!1),$("#form_result").html(a),$("#success-alert,#error-alert,#info-alert,#warning-alert").fadeTo(1e3,500).slideUp(1e3,function(){$("#success-alert,#error-alert").slideUp(500)}),$("#myModal").modal("hide")}})}),$('input[type="checkbox"]').click(n).each(n),$("#nama").on("input",function(){"Add"==$("#action").val()&&(nama=$(this).val(),username=nama.replace(/[^a-zA-Z]/g,""),nama=username,username=username.slice(0,7),number=Math.floor(1e3+9e3*Math.random()),anggota="BP3C"+Math.floor(1e5+982718*Math.random()),anggota=anggota.slice(0,10),""==nama?(document.getElementById("username").value="",document.getElementById("anggota").value=""):(document.getElementById("username").value=username+number,document.getElementById("anggota").value=anggota))}),$(".toggle-password").click(function(){$(this).toggleClass("fa-eye fa-eye-slash");var e=$($(this).attr("toggle"));"password"==e.attr("type")?e.attr("type","text"):e.attr("type","password")}),$(document).on("click",".delete",function(){a=$(this).attr("id"),username=$(this).attr("nama"),$(".titles").text("Hapus data "+username+" ?"),$("#confirmModal").modal("show")}),$("#ok_button").click(function(){$.ajax({url:"/pedagang/destroy/"+a,cache:!1,beforeSend:function(){$("#ok_button").text("Menghapus...")},success:function(e){$("#tabelPedagang").DataTable().ajax.reload(function(){},!1),e.success&&(html='<div class="alert alert-success" id="success-alert"> <strong>Sukses! </strong>'+e.success+"</div>"),e.errors&&(html='<div class="alert alert-danger" id="error-alert"> <strong>Oops! </strong>'+e.errors+"</div>"),$("#form_result").html(html),$("#success-alert,#error-alert,#info-alert,#warning-alert").fadeTo(1e3,500).slideUp(1e3,function(){$("#success-alert,#error-alert").slideUp(500)}),$("#confirmModal").modal("hide")},complete:function(){$("#ok_button").text("Hapus")}})}),$(document).on("click",".details",function(){e=$(this).attr("id"),username=$(this).attr("nama"),$(".titles").html("<h1 style='color:white;font-weight:700;'>"+username+"</h1>"),$.ajax({url:"/pedagang/"+e,cache:!1,dataType:"json",success:function(e){null!==e.result.ktp?$(".ktp").text(e.result.ktp):$(".ktp").html("&mdash;"),null!==e.result.anggota?$(".anggota").text(e.result.anggota):$(".anggota").html("&mdash;"),null!==e.result.alamat?$(".alamat").text(e.result.alamat):$(".alamat").html("&mdash;"),null!==e.result.hp?$("#whatsapp-number").attr("href","https://api.whatsapp.com/send?phone="+e.result.hp+"&text=*Selamat%20Berniaga%20Mitra%20BP3C*").attr("target","_blank").css("pointer-events","").removeClass("btn-dark").addClass("btn-success"):$("#whatsapp-number").attr("href","#").removeAttr("target").css("pointer-events","none").removeClass("btn-success").addClass("btn-dark"),null!==e.result.email?$("#email-number").attr("href","mailto:"+e.result.email).attr("target","_blank").css("pointer-events","").removeClass("btn-dark").addClass("btn-danger"):$("#email-number").attr("href","#").removeAttr("target").css("pointer-events","none").removeClass("btn-danger").addClass("btn-dark"),$("#show-details").modal("show")}})}),$('input[type="checkbox"]').click(r).each(r),$('input[type="checkbox"]').click(s).each(s),$("[type=tel]").on("change",function(e){$(e.target).val($(e.target).val().replace(/[^\d\.]/g,""))}),$("[type=tel]").on("keypress",function(e){return keys=["0","1","2","3","4","5","6","7","8","9"],keys.indexOf(e.key)>-1}),$("#nama").on("change paste keyup",function(e){$(e.target).val($(e.target).val().replace(/[^a-zA-Z.\s]/gi,""))})});